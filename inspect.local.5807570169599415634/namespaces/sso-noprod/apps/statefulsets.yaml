---
apiVersion: apps/v1
items:
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    creationTimestamp: "2024-01-31T21:46:52Z"
    generation: 11
    labels:
      app: keycloak
      com.company: Red_Hat
      component: keycloak
      rht.comp: SSO
      rht.comp_ver: 7.6.7
      rht.prod_name: Red_Hat_Runtimes
      rht.prod_ver: 2024_Q1
      rht.subcomp: SSO_Server
      rht.subcomp_t: application
    managedFields:
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:labels:
            .: {}
            f:app: {}
            f:com.company: {}
            f:component: {}
            f:rht.comp: {}
            f:rht.comp_ver: {}
            f:rht.prod_name: {}
            f:rht.prod_ver: {}
            f:rht.subcomp: {}
            f:rht.subcomp_t: {}
          f:ownerReferences:
            .: {}
            k:{"uid":"3f95cbd7-aa83-4561-add8-26cba88d49b8"}: {}
        f:spec:
          f:persistentVolumeClaimRetentionPolicy:
            .: {}
            f:whenDeleted: {}
            f:whenScaled: {}
          f:podManagementPolicy: {}
          f:replicas: {}
          f:revisionHistoryLimit: {}
          f:selector: {}
          f:template:
            f:metadata:
              f:labels:
                .: {}
                f:app: {}
                f:com.company: {}
                f:component: {}
                f:rht.comp: {}
                f:rht.comp_ver: {}
                f:rht.prod_name: {}
                f:rht.prod_ver: {}
                f:rht.subcomp: {}
                f:rht.subcomp_t: {}
              f:name: {}
              f:namespace: {}
            f:spec:
              f:affinity:
                .: {}
                f:podAntiAffinity:
                  .: {}
                  f:preferredDuringSchedulingIgnoredDuringExecution: {}
              f:containers:
                k:{"name":"keycloak"}:
                  .: {}
                  f:env:
                    .: {}
                    k:{"name":"CACHE_OWNERS_AUTH_SESSIONS_COUNT"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"CACHE_OWNERS_COUNT"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"DB_DATABASE"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"DB_JNDI"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"DB_PASSWORD"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"DB_SCHEMA"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"DB_SERVICE_PREFIX_MAPPING"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"DB_USERNAME"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"JAVA_INITIAL_MEM_RATIO"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"JAVA_MAX_MEM_RATIO"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"JGROUPS_PING_PROTOCOL"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"OPENSHIFT_DNS_PING_SERVICE_NAME"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"SSO_ADMIN_PASSWORD"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"SSO_ADMIN_USERNAME"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"STATISTICS_ENABLED"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"TX_DATABASE_PREFIX_MAPPING"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"TZ"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"X509_CA_BUNDLE"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                  f:image: {}
                  f:imagePullPolicy: {}
                  f:livenessProbe:
                    .: {}
                    f:exec:
                      .: {}
                      f:command: {}
                    f:failureThreshold: {}
                    f:initialDelaySeconds: {}
                    f:periodSeconds: {}
                    f:successThreshold: {}
                    f:timeoutSeconds: {}
                  f:name: {}
                  f:ports:
                    .: {}
                    k:{"containerPort":8080,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                    k:{"containerPort":8443,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                    k:{"containerPort":8778,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                    k:{"containerPort":9990,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                  f:readinessProbe:
                    .: {}
                    f:exec:
                      .: {}
                      f:command: {}
                    f:failureThreshold: {}
                    f:initialDelaySeconds: {}
                    f:periodSeconds: {}
                    f:successThreshold: {}
                    f:timeoutSeconds: {}
                  f:resources:
                    .: {}
                    f:limits:
                      .: {}
                      f:memory: {}
                    f:requests:
                      .: {}
                      f:memory: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
                  f:volumeMounts:
                    .: {}
                    k:{"mountPath":"/etc/x509/https"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                    k:{"mountPath":"/mnt/rh-sso"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                    k:{"mountPath":"/opt/eap/standalone/deployments"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                    k:{"mountPath":"/probes"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
              f:dnsPolicy: {}
              f:initContainers:
                .: {}
                k:{"name":"extensions-init"}:
                  .: {}
                  f:env:
                    .: {}
                    k:{"name":"KEYCLOAK_EXTENSIONS"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                  f:image: {}
                  f:imagePullPolicy: {}
                  f:name: {}
                  f:resources:
                    .: {}
                    f:limits:
                      .: {}
                      f:memory: {}
                    f:requests:
                      .: {}
                      f:memory: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
                  f:volumeMounts:
                    .: {}
                    k:{"mountPath":"/opt/extensions"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
              f:restartPolicy: {}
              f:schedulerName: {}
              f:securityContext: {}
              f:terminationGracePeriodSeconds: {}
              f:volumes:
                .: {}
                k:{"name":"keycloak-extensions"}:
                  .: {}
                  f:emptyDir: {}
                  f:name: {}
                k:{"name":"keycloak-probes"}:
                  .: {}
                  f:configMap:
                    .: {}
                    f:defaultMode: {}
                    f:name: {}
                  f:name: {}
                k:{"name":"sso-probe-netrc-volume"}:
                  .: {}
                  f:emptyDir:
                    .: {}
                    f:medium: {}
                  f:name: {}
                k:{"name":"sso-x509-https-secret"}:
                  .: {}
                  f:name: {}
                  f:secret:
                    .: {}
                    f:defaultMode: {}
                    f:optional: {}
                    f:secretName: {}
          f:updateStrategy:
            f:rollingUpdate:
              .: {}
              f:partition: {}
            f:type: {}
      manager: keycloak-operator
      operation: Update
      time: "2024-03-12T03:13:54Z"
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:status:
          f:availableReplicas: {}
          f:readyReplicas: {}
      manager: kube-controller-manager
      operation: Update
      time: "2024-03-28T20:14:55Z"
    name: keycloak
    namespace: sso-noprod
    ownerReferences:
    - apiVersion: keycloak.org/v1alpha1
      blockOwnerDeletion: true
      controller: true
      kind: Keycloak
      name: keycloak
      uid: 3f95cbd7-aa83-4561-add8-26cba88d49b8
    resourceVersion: "152565863"
    uid: 3acd5e88-ab2d-4fcb-8951-5140f5fe3f35
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Retain
      whenScaled: Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app: keycloak
        component: keycloak
    serviceName: ""
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: keycloak
          com.company: Red_Hat
          component: keycloak
          rht.comp: SSO
          rht.comp_ver: 7.6.7
          rht.prod_name: Red_Hat_Runtimes
          rht.prod_ver: 2024_Q1
          rht.subcomp: SSO_Server
          rht.subcomp_t: application
        name: keycloak
        namespace: sso-noprod
      spec:
        affinity:
          podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: app
                    operator: In
                    values:
                    - keycloak
                topologyKey: topology.kubernetes.io/zone
              weight: 100
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: app
                    operator: In
                    values:
                    - keycloak
                topologyKey: kubernetes.io/hostname
              weight: 90
        containers:
        - env:
          - name: JAVA_INITIAL_MEM_RATIO
            value: "50"
          - name: JAVA_MAX_MEM_RATIO
            value: "80"
          - name: TZ
            value: America/Santiago
          - name: DB_SERVICE_PREFIX_MAPPING
            value: keycloak-postgresql=DB
          - name: TX_DATABASE_PREFIX_MAPPING
            value: keycloak-postgresql=DB
          - name: DB_JNDI
            value: java:jboss/datasources/KeycloakDS
          - name: DB_SCHEMA
            value: public
          - name: DB_USERNAME
            valueFrom:
              secretKeyRef:
                key: POSTGRES_USERNAME
                name: keycloak-db-secret
          - name: DB_PASSWORD
            valueFrom:
              secretKeyRef:
                key: POSTGRES_PASSWORD
                name: keycloak-db-secret
          - name: DB_DATABASE
            value: root
          - name: JGROUPS_PING_PROTOCOL
            value: dns.DNS_PING
          - name: OPENSHIFT_DNS_PING_SERVICE_NAME
            value: keycloak-discovery.sso-noprod.svc.cluster.local
          - name: CACHE_OWNERS_COUNT
            value: "2"
          - name: CACHE_OWNERS_AUTH_SESSIONS_COUNT
            value: "2"
          - name: SSO_ADMIN_USERNAME
            valueFrom:
              secretKeyRef:
                key: ADMIN_USERNAME
                name: credential-keycloak
          - name: SSO_ADMIN_PASSWORD
            valueFrom:
              secretKeyRef:
                key: ADMIN_PASSWORD
                name: credential-keycloak
          - name: X509_CA_BUNDLE
            value: /var/run/secrets/kubernetes.io/serviceaccount/*.crt
          - name: STATISTICS_ENABLED
            value: "TRUE"
          image: registry.redhat.io/rh-sso-7/sso76-openshift-rhel8@sha256:21033463e761a6ff142551fa93ec20196ad46f18b0dc4a0c692866d4410c64ce
          imagePullPolicy: Always
          livenessProbe:
            exec:
              command:
              - /bin/sh
              - -c
              - /probes/liveness_probe.sh
            failureThreshold: 10
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 22
          name: keycloak
          ports:
          - containerPort: 8443
            protocol: TCP
          - containerPort: 8080
            protocol: TCP
          - containerPort: 9990
            protocol: TCP
          - containerPort: 8778
            protocol: TCP
          readinessProbe:
            exec:
              command:
              - /bin/sh
              - -c
              - /probes/readiness_probe.sh
            failureThreshold: 10
            initialDelaySeconds: 40
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 22
          resources:
            limits:
              memory: 2Gi
            requests:
              memory: 1Gi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/x509/https
            name: sso-x509-https-secret
          - mountPath: /opt/eap/standalone/deployments
            name: keycloak-extensions
          - mountPath: /probes
            name: keycloak-probes
          - mountPath: /mnt/rh-sso
            name: sso-probe-netrc-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - env:
          - name: KEYCLOAK_EXTENSIONS
            value: http://sso-theme-httpd-svc:8080/clh-theme-latest.jar
          image: registry.redhat.io/rh-sso-7/sso7-rhel8-init-container@sha256:c9634cf64e2b0c3a7e8314b870dba12bb6a370b44545f9347ca577f7a5a13103
          imagePullPolicy: Always
          name: extensions-init
          resources:
            limits:
              memory: 2Gi
            requests:
              memory: 1Gi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /opt/extensions
            name: keycloak-extensions
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: sso-x509-https-secret
          secret:
            defaultMode: 420
            optional: true
            secretName: sso-x509-https-secret
        - emptyDir: {}
          name: keycloak-extensions
        - configMap:
            defaultMode: 365
            name: keycloak-probes
          name: keycloak-probes
        - emptyDir:
            medium: Memory
          name: sso-probe-netrc-volume
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: keycloak-5d8f9c8ff9
    observedGeneration: 11
    readyReplicas: 1
    replicas: 1
    updateRevision: keycloak-5d8f9c8ff9
    updatedReplicas: 1
kind: StatefulSetList
metadata:
  resourceVersion: "152573820"
